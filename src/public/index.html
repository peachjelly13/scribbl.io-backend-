<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skribbl Clone</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>

    <h1>Welcome to the Game!</h1>
    <p>Open the console (F12 > Console) to see WebSocket logs.</p>
    <button id="joinBtn">Join Game</button>

    <script>
        const socket = io("http://localhost:3000"); // Ensure this matches your backend

        // When connected
        socket.on("connect", () => {
            console.log("Connected to server:", socket.id);

            // Try reconnecting using localStorage if user already has an ID
            const storedUserId = localStorage.getItem("userId");
            const storedRoomId = localStorage.getItem("roomId");

            if (storedUserId && storedRoomId) {
                console.log("Attempting to reconnect with stored userId and roomId...");
                socket.emit("reconnectUser", { userId: storedUserId, roomId: storedRoomId });
            }
        });

        socket.on("disconnect", () => {
            console.log("Disconnected from server");
        });

        function joinGame() {
            const username = "JohnDoe"; // Replace with actual user input
            const avatar = "profile.png"; // Replace with actual user input
            const privateRoomId = null; // Or provide a room ID if applicable

            socket.emit("connectUser", { username, avatar, privateRoomId });

            // Listen for the roomJoined event
            socket.on("roomJoined", ({ roomId, userId }) => {
                console.log(`Joined room: ${roomId}`);

                // Store userId and roomId in localStorage
                localStorage.setItem("userId", userId);
                localStorage.setItem("roomId", roomId);
            });
        }

        // Attach event listener after DOM loads
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("joinBtn").addEventListener("click", joinGame);
        });

    </script>

</body>
</html>
